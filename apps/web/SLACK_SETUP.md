# Slack連携設定ガイド

このガイドでは、Gyulistのお問い合わせ機能をSlackと連携させる方法を説明します。

## 前提条件

- Slackワークスペースへのアクセス権限
- 管理者権限（アプリの作成・設定）

## 設定手順

### 1. Slackアプリの作成

1. [Slack API](https://api.slack.com/apps) にアクセス
2. "Create New App" → "From scratch" を選択
3. アプリ名（例：`Gyulist Contact Bot`）とワークスペースを選択
4. "Create App" をクリック

### 2. Incoming Webhooksの有効化

1. 左サイドバーの "Features" → "Incoming Webhooks" を選択
2. "Activate Incoming Webhooks" をオンにする
3. "Add New Webhook to Workspace" をクリック
4. 送信先チャンネルを選択（例：`#お問い合わせ`）
5. "Allow" をクリック
6. Webhook URLをコピー（`https://hooks.slack.com/services/...`）

### 3. 環境変数の設定

プロジェクトのルートディレクトリに `.env.local` ファイルを作成し、以下の内容を追加：

```bash
# Slack連携設定
SLACK_WEBHOOK_URL=https://hooks.slack.com/services/YOUR/WORKSPACE/WEBHOOK

# 管理者APIトークン（Slack接続テスト用）
ADMIN_API_TOKEN=your-secure-admin-token-here
```

**重要**: `.env.local` ファイルは `.gitignore` に含まれており、Gitにコミットされません。

### 4. 接続テスト

1. アプリケーションを起動
2. 設定画面（`/settings`）にアクセス
3. 「サポート」セクションの「Slack設定」ボタンをクリック
4. 管理者トークンを入力
5. 「Slack接続テストを実行」ボタンをクリック

テストが成功すると、指定したSlackチャンネルにテストメッセージが送信されます。

## 機能の動作

### お問い合わせ受信時

ユーザーがお問い合わせフォームを送信すると、以下の情報がSlackに送信されます：

- 📧 新しいお問い合わせ
- お名前
- メールアドレス
- 件名（日本語ラベル付き）
- 受信日時（日本時間）
- お問い合わせ内容
- システム情報

### 件名の種類

- 一般的なお問い合わせ
- 技術的なサポート
- 機能のご要望
- バグの報告
- 料金に関するお問い合わせ
- その他

## トラブルシューティング

### Webhook URLが無効

- Slackアプリの設定でIncoming Webhooksが有効になっているか確認
- Webhook URLが正しくコピーされているか確認
- ワークスペースの権限設定を確認

### 認証エラー

- `ADMIN_API_TOKEN` が正しく設定されているか確認
- 環境変数ファイル（`.env.local`）が正しい場所にあるか確認
- アプリケーションの再起動が必要な場合があります

### メッセージが送信されない

- Slackチャンネルの権限設定を確認
- アプリがチャンネルに追加されているか確認
- ブラウザのコンソールでエラーメッセージを確認

## セキュリティに関する注意事項

- `ADMIN_API_TOKEN` は推測困難な文字列を使用してください
- Webhook URLは機密情報として扱い、公開しないでください
- 本番環境では適切な認証・認可の仕組みを実装してください

## 今後の拡張予定

- お問い合わせの自動返信機能
- 管理者向けお問い合わせ管理画面
- お問い合わせの優先度設定
- カスタム通知設定

## サポート

設定で問題が発生した場合は、以下を確認してください：

1. ブラウザのコンソールでエラーメッセージ
2. アプリケーションのログ
3. Slackアプリの設定状況

それでも解決しない場合は、開発チームまでお問い合わせください。
