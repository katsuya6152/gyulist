# Test Suite - New Architecture

æ–°ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£ç”¨ã®åŒ…æ‹¬çš„ãƒ†ã‚¹ãƒˆã‚¹ã‚¤ãƒ¼ãƒˆ

## ğŸ“ ãƒ†ã‚¹ãƒˆæ§‹æˆ

```
tests/
â”œâ”€â”€ unit/                    # ãƒ¦ãƒ‹ãƒƒãƒˆãƒ†ã‚¹ãƒˆ
â”‚   â”œâ”€â”€ domain/             # ãƒ‰ãƒ¡ã‚¤ãƒ³å±¤ãƒ†ã‚¹ãƒˆ
â”‚   â”‚   â”œâ”€â”€ cattle.test.ts  # ç‰›ç®¡ç†ãƒ‰ãƒ¡ã‚¤ãƒ³ãƒ­ã‚¸ãƒƒã‚¯
â”‚   â”‚   â””â”€â”€ kpi.test.ts     # KPIè¨ˆç®—ãƒ­ã‚¸ãƒƒã‚¯
â”‚   â”œâ”€â”€ application/        # ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³å±¤ãƒ†ã‚¹ãƒˆ
â”‚   â”‚   â””â”€â”€ cattle-usecases.test.ts # ãƒ¦ãƒ¼ã‚¹ã‚±ãƒ¼ã‚¹ãƒ†ã‚¹ãƒˆ
â”‚   â”œâ”€â”€ lib/                # ãƒ©ã‚¤ãƒ–ãƒ©ãƒªãƒ†ã‚¹ãƒˆ
â”‚   â””â”€â”€ middleware/         # ãƒŸãƒ‰ãƒ«ã‚¦ã‚§ã‚¢ãƒ†ã‚¹ãƒˆ
â”œâ”€â”€ integration/            # çµ±åˆãƒ†ã‚¹ãƒˆ
â”‚   â”œâ”€â”€ cattle/             # ç‰›ç®¡ç†APIçµ±åˆãƒ†ã‚¹ãƒˆ
â”‚   â”œâ”€â”€ events/             # ã‚¤ãƒ™ãƒ³ãƒˆç®¡ç†APIçµ±åˆãƒ†ã‚¹ãƒˆ
â”‚   â”œâ”€â”€ kpi/                # KPI APIçµ±åˆãƒ†ã‚¹ãƒˆ
â”‚   â”œâ”€â”€ alerts/             # ã‚¢ãƒ©ãƒ¼ãƒˆç®¡ç†APIçµ±åˆãƒ†ã‚¹ãƒˆ
â”‚   â””â”€â”€ auth/               # èªè¨¼APIçµ±åˆãƒ†ã‚¹ãƒˆ
â”œâ”€â”€ e2e/                    # ã‚¨ãƒ³ãƒ‰ãƒ„ãƒ¼ã‚¨ãƒ³ãƒ‰ãƒ†ã‚¹ãƒˆ
â”‚   â””â”€â”€ api-workflow.test.ts # å…¨APIãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼ãƒ†ã‚¹ãƒˆ
â””â”€â”€ performance/            # ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹ãƒ†ã‚¹ãƒˆ
    â”œâ”€â”€ api-benchmark.test.ts # APIãƒ™ãƒ³ãƒãƒãƒ¼ã‚¯
    â””â”€â”€ benchmarks.ts       # ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹è¨­å®š
```

## ğŸš€ ãƒ†ã‚¹ãƒˆå®Ÿè¡Œã‚³ãƒãƒ³ãƒ‰

### åŸºæœ¬ãƒ†ã‚¹ãƒˆ
```bash
# å…¨ãƒ†ã‚¹ãƒˆå®Ÿè¡Œ
pnpm test:run

# ãƒ¦ãƒ‹ãƒƒãƒˆãƒ†ã‚¹ãƒˆã®ã¿
pnpm test:run tests/unit/

# çµ±åˆãƒ†ã‚¹ãƒˆã®ã¿
pnpm test:run tests/integration/

# E2Eãƒ†ã‚¹ãƒˆã®ã¿
pnpm test:run tests/e2e/

# ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹ãƒ†ã‚¹ãƒˆã®ã¿
pnpm test:run tests/performance/
```

### ç‰¹å®šãƒ‰ãƒ¡ã‚¤ãƒ³ãƒ†ã‚¹ãƒˆ
```bash
# ç‰›ç®¡ç†é–¢é€£ãƒ†ã‚¹ãƒˆ
pnpm test:run tests/unit/domain/cattle.test.ts
pnpm test:run tests/integration/cattle/

# KPIé–¢é€£ãƒ†ã‚¹ãƒˆ
pnpm test:run tests/unit/domain/kpi.test.ts
pnpm test:run tests/integration/kpi/

# èªè¨¼é–¢é€£ãƒ†ã‚¹ãƒˆ
pnpm test:run tests/integration/auth/
```

### ã‚«ãƒãƒ¬ãƒƒã‚¸ãƒ¬ãƒãƒ¼ãƒˆ
```bash
# ã‚«ãƒãƒ¬ãƒƒã‚¸ä»˜ããƒ†ã‚¹ãƒˆå®Ÿè¡Œ
pnpm test:coverage

# HTMLãƒ¬ãƒãƒ¼ãƒˆç”Ÿæˆ
pnpm test:coverage --reporter=html
```

## ğŸ“Š ãƒ†ã‚¹ãƒˆç¨®åˆ¥

### 1. ãƒ¦ãƒ‹ãƒƒãƒˆãƒ†ã‚¹ãƒˆ
- **ãƒ‰ãƒ¡ã‚¤ãƒ³é–¢æ•°**: ç´”ç²‹é–¢æ•°ã®ãƒ­ã‚¸ãƒƒã‚¯ãƒ†ã‚¹ãƒˆ
- **ãƒ¦ãƒ¼ã‚¹ã‚±ãƒ¼ã‚¹**: ãƒ“ã‚¸ãƒã‚¹ãƒ­ã‚¸ãƒƒã‚¯ã®ãƒ†ã‚¹ãƒˆ
- **ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³**: å…¥åŠ›æ¤œè¨¼ã®ãƒ†ã‚¹ãƒˆ

### 2. çµ±åˆãƒ†ã‚¹ãƒˆ
- **API ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆ**: HTTPãƒªã‚¯ã‚¨ã‚¹ãƒˆ/ãƒ¬ã‚¹ãƒãƒ³ã‚¹ãƒ†ã‚¹ãƒˆ
- **èªè¨¼ãƒ•ãƒ­ãƒ¼**: JWTèªè¨¼ã®ãƒ†ã‚¹ãƒˆ
- **ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹é€£æº**: ãƒªãƒã‚¸ãƒˆãƒªå®Ÿè£…ã®ãƒ†ã‚¹ãƒˆ

### 3. ã‚¨ãƒ³ãƒ‰ãƒ„ãƒ¼ã‚¨ãƒ³ãƒ‰ãƒ†ã‚¹ãƒˆ
- **å®Œå…¨ãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼**: ç‰›ç®¡ç†ã®å…¨ãƒ©ã‚¤ãƒ•ã‚µã‚¤ã‚¯ãƒ«
- **ã‚¯ãƒ­ã‚¹ãƒ‰ãƒ¡ã‚¤ãƒ³**: è¤‡æ•°ãƒ‰ãƒ¡ã‚¤ãƒ³ã«ã¾ãŸãŒã‚‹å‡¦ç†
- **ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°**: ç•°å¸¸ç³»ã®å‹•ä½œç¢ºèª

### 4. ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹ãƒ†ã‚¹ãƒˆ
- **ãƒ¬ã‚¹ãƒãƒ³ã‚¹æ™‚é–“**: å„APIã®å¿œç­”é€Ÿåº¦
- **ãƒ¡ãƒ¢ãƒªä½¿ç”¨é‡**: ãƒ¡ãƒ¢ãƒªãƒªãƒ¼ã‚¯æ¤œå‡º
- **åŒæ™‚å®Ÿè¡Œ**: ä¸¦è¡Œãƒªã‚¯ã‚¨ã‚¹ãƒˆå‡¦ç†
- **ã‚¹ã‚±ãƒ¼ãƒ©ãƒ“ãƒªãƒ†ã‚£**: å¤§é‡ãƒ‡ãƒ¼ã‚¿å‡¦ç†

## ğŸ¯ ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹ç›®æ¨™

| é …ç›® | ç›®æ¨™å€¤ |
|------|--------|
| ãƒ˜ãƒ«ã‚¹ãƒã‚§ãƒƒã‚¯ | < 50ms |
| å˜ç´”GETæ“ä½œ | < 200ms |
| è¤‡é›‘è¨ˆç®—å‡¦ç† | < 500ms |
| ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹æ“ä½œ | < 1000ms |
| ãƒ¡ãƒ¢ãƒªå¢—åŠ é‡ | < 10MB |
| åŒæ™‚å®Ÿè¡Œæ•° | 50ãƒªã‚¯ã‚¨ã‚¹ãƒˆ |

## ğŸ”§ ãƒ†ã‚¹ãƒˆè¨­å®š

### Mockè¨­å®š
- **drizzle-orm/d1**: ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ãƒ¢ãƒƒã‚¯
- **JWTèªè¨¼**: ãƒˆãƒ¼ã‚¯ãƒ³æ¤œè¨¼ãƒ¢ãƒƒã‚¯
- **å¤–éƒ¨API**: ã‚µãƒ¼ãƒ“ã‚¹å‘¼ã³å‡ºã—ãƒ¢ãƒƒã‚¯

### ç’°å¢ƒå¤‰æ•°
```bash
NODE_ENV=test
JWT_SECRET=test-secret
```

## ğŸ“ˆ ãƒ†ã‚¹ãƒˆå“è³ªæŒ‡æ¨™

### ã‚«ãƒãƒ¬ãƒƒã‚¸ç›®æ¨™
- **ãƒ‰ãƒ¡ã‚¤ãƒ³å±¤**: 80%ä»¥ä¸Š
- **ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³å±¤**: 70%ä»¥ä¸Š
- **ã‚¤ãƒ³ãƒ•ãƒ©å±¤**: 60%ä»¥ä¸Š
- **ã‚¤ãƒ³ã‚¿ãƒ¼ãƒ•ã‚§ãƒ¼ã‚¹å±¤**: 50%ä»¥ä¸Š

### ãƒ†ã‚¹ãƒˆå®Ÿè¡Œæ™‚é–“
- **ãƒ¦ãƒ‹ãƒƒãƒˆãƒ†ã‚¹ãƒˆ**: < 500ms
- **çµ±åˆãƒ†ã‚¹ãƒˆ**: < 2000ms
- **E2Eãƒ†ã‚¹ãƒˆ**: < 5000ms
- **ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹ãƒ†ã‚¹ãƒˆ**: < 10000ms

## ğŸ› ãƒˆãƒ©ãƒ–ãƒ«ã‚·ãƒ¥ãƒ¼ãƒ†ã‚£ãƒ³ã‚°

### ã‚ˆãã‚ã‚‹å•é¡Œ
1. **ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«è§£æ±ºã‚¨ãƒ©ãƒ¼**: ãƒ‘ã‚¹ã‚¨ã‚¤ãƒªã‚¢ã‚¹è¨­å®šã‚’ç¢ºèª
2. **å‹ã‚¨ãƒ©ãƒ¼**: Brandå‹ã®é©åˆ‡ãªã‚­ãƒ£ã‚¹ãƒˆ
3. **ãƒ¢ãƒƒã‚¯ã‚¨ãƒ©ãƒ¼**: vi.mock()ã®è¨­å®šç¢ºèª

### ãƒ‡ãƒãƒƒã‚°æ–¹æ³•
```bash
# è©³ç´°ãƒ­ã‚°ä»˜ããƒ†ã‚¹ãƒˆ
pnpm test:run --reporter=verbose

# ç‰¹å®šãƒ†ã‚¹ãƒˆã®ã¿å®Ÿè¡Œ
pnpm test:run -t "should create cattle"

# ã‚¦ã‚©ãƒƒãƒãƒ¢ãƒ¼ãƒ‰
pnpm test:watch
```

---

**æ–°ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£ç”¨ã®åŒ…æ‹¬çš„ãƒ†ã‚¹ãƒˆã‚¹ã‚¤ãƒ¼ãƒˆãŒå®Œæˆã—ã¾ã—ãŸï¼**
