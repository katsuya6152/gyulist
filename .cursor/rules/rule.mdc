---
alwaysApply: true
---

# Gyulist - ç‰›ç¾¤ç®¡ç†ã‚·ã‚¹ãƒ†ãƒ  Cursorãƒ«ãƒ¼ãƒ«

## ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆæ¦‚è¦
Gyulistã¯ç‰›ã®å€‹ä½“ç®¡ç†ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã§ã€Next.js 15 + Hono + Cloudflare Workersã‚’ä½¿ç”¨ã—ãŸãƒ¢ãƒãƒ¬ãƒæ§‹æˆã§ã™ã€‚

## ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£åŸå‰‡

### ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰ï¼ˆAPIï¼‰
- **Functional Domain Modeling (FDM)** + **ãƒ˜ã‚­ã‚µã‚´ãƒŠãƒ«ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£**ã‚’æ¡ç”¨
- **Resultå‹**ã«ã‚ˆã‚‹æ˜ç¤ºçš„ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°
- **Brandå‹**ã«ã‚ˆã‚‹å‹å®‰å…¨æ€§ã®å¼·åŒ–
- **æ§‹é€ åŒ–ãƒ­ã‚°**ã«ã‚ˆã‚‹é‹ç”¨æ€§å‘ä¸Š
- **ä¾å­˜æ³¨å…¥**ã«ã‚ˆã‚‹ãƒ†ã‚¹ã‚¿ãƒ“ãƒªãƒ†ã‚£ç¢ºä¿

### ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰ï¼ˆWebï¼‰
- **Container/Presentational**ãƒ‘ã‚¿ãƒ¼ãƒ³ã«ã‚ˆã‚‹è²¬å‹™åˆ†é›¢
- **Server Components**ã«ã‚ˆã‚‹ãƒ‡ãƒ¼ã‚¿å–å¾—æœ€é©åŒ–
- **Server Actions**ã«ã‚ˆã‚‹ãƒ•ã‚©ãƒ¼ãƒ å‡¦ç†
- **Zod**ã«ã‚ˆã‚‹å‹å®‰å…¨ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³

## ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªæ§‹é€ ãƒ«ãƒ¼ãƒ«

### ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰ï¼ˆapps/api/src/ï¼‰
```
contexts/[domain]/
â”œâ”€â”€ domain/              # ãƒ‰ãƒ¡ã‚¤ãƒ³ãƒ­ã‚¸ãƒƒã‚¯ï¼ˆç´”ç²‹é–¢æ•°ï¼‰
â”‚   â”œâ”€â”€ codecs/         # å…¥å‡ºåŠ›å¤‰æ›ï¼ˆinput.ts, output.tsï¼‰
â”‚   â”œâ”€â”€ errors.ts       # ãƒ‰ãƒ¡ã‚¤ãƒ³ã‚¨ãƒ©ãƒ¼å®šç¾©
â”‚   â”œâ”€â”€ model/          # ãƒ‰ãƒ¡ã‚¤ãƒ³ãƒ¢ãƒ‡ãƒ«
â”‚   â””â”€â”€ services/       # ãƒ¦ãƒ¼ã‚¹ã‚±ãƒ¼ã‚¹
â”œâ”€â”€ infra/              # ã‚¤ãƒ³ãƒ•ãƒ©å®Ÿè£…
â”‚   â”œâ”€â”€ drizzle/        # DBå®Ÿè£…
â”‚   â””â”€â”€ mappers/        # ãƒ‡ãƒ¼ã‚¿å¤‰æ›ï¼ˆdbToDomain.ts, domainToDb.tsï¼‰
â”œâ”€â”€ presentation/       # HTTPå±¤
â”œâ”€â”€ ports.ts           # ã‚¤ãƒ³ã‚¿ãƒ¼ãƒ•ã‚§ãƒ¼ã‚¹å®šç¾©
â””â”€â”€ tests/             # ãƒ‰ãƒ¡ã‚¤ãƒ³å›ºæœ‰ãƒ†ã‚¹ãƒˆ
```

### ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰ï¼ˆapps/web/src/ï¼‰
```
features/[feature]/[operation]/
â”œâ”€â”€ container.tsx          # Server Componentï¼ˆãƒ‡ãƒ¼ã‚¿å–å¾—ï¼‰
â”œâ”€â”€ presentational.tsx     # Client Componentï¼ˆUIè¡¨ç¤ºï¼‰
â”œâ”€â”€ actions.ts             # Server Actionsï¼ˆãƒ•ã‚©ãƒ¼ãƒ å‡¦ç†ï¼‰
â”œâ”€â”€ schema.ts              # Zodãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³ã‚¹ã‚­ãƒ¼ãƒ
â”œâ”€â”€ constants.ts           # å®šæ•°å®šç¾©
â”œâ”€â”€ types.ts               # å‹å®šç¾©
â”œâ”€â”€ components/            # å°‚ç”¨ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆ
â””â”€â”€ __tests__/             # ãƒ†ã‚¹ãƒˆãƒ•ã‚¡ã‚¤ãƒ«
```

## ã‚³ãƒ¼ãƒ‡ã‚£ãƒ³ã‚°è¦ç´„

### å‘½åè¦å‰‡
- **ãƒ•ã‚¡ã‚¤ãƒ«**: `kebab-case.tsx`ï¼ˆã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆï¼‰, `camelCase.ts`ï¼ˆãƒ¦ãƒ¼ãƒ†ã‚£ãƒªãƒ†ã‚£ï¼‰
- **å¤‰æ•°ãƒ»é–¢æ•°**: `camelCase`
- **å®šæ•°**: `UPPER_SNAKE_CASE`
- **å‹ãƒ»ã‚¤ãƒ³ã‚¿ãƒ¼ãƒ•ã‚§ãƒ¼ã‚¹**: `PascalCase`
- **Brandå‹**: `EntityId`ï¼ˆä¾‹: `CattleId`, `UserId`ï¼‰

### ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰å®Ÿè£…ãƒ«ãƒ¼ãƒ«

#### FDMãƒ‘ã‚¿ãƒ¼ãƒ³ã®å¾¹åº•
```typescript
// âœ… æ­£ã—ã„ä¾‹: ãƒ‰ãƒ¡ã‚¤ãƒ³ã‚µãƒ¼ãƒ“ã‚¹
export function createCattle(deps: CattleDeps) {
  return async (input: CreateCattleInput): Promise<Result<CattleId, CattleError>> => {
    // ç´”ç²‹ãªãƒ“ã‚¸ãƒã‚¹ãƒ­ã‚¸ãƒƒã‚¯
    const validation = validateCattleData(input);
    if (!validation.ok) return validation;
    
    const cattleId = await deps.repo.create(input);
    return { ok: true, value: cattleId };
  };
}

// âœ… æ­£ã—ã„ä¾‹: Repositoryå®Ÿè£…ï¼ˆMappersä½¿ç”¨ï¼‰
export function makeCattleRepo(db: AnyD1Database): CattleRepoPort {
  return {
    async findById(id: CattleId): Promise<Cattle | null> {
      const [row] = await dbInstance.select().from(cattleTable).where(eq(cattleTable.id, id as number));
      return row ? toDomain(row) : null; // Mappersä½¿ç”¨
    }
  };
}
```

#### Resultå‹ã«ã‚ˆã‚‹ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°
```typescript
// âœ… æ­£ã—ã„ä¾‹: æ˜ç¤ºçš„ã‚¨ãƒ©ãƒ¼å‹
export type CattleError = 
  | { type: "ValidationError"; field: string; message: string }
  | { type: "NotFound"; message: string }
  | { type: "InfraError"; cause: unknown };

// âœ… æ­£ã—ã„ä¾‹: Resultå‹ä½¿ç”¨
export async function getCattle(id: CattleId): Promise<Result<Cattle, CattleError>> {
  const cattle = await repo.findById(id);
  if (!cattle) {
    return { ok: false, error: { type: "NotFound", message: "ç‰›ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“" } };
  }
  return { ok: true, value: cattle };
}
```

#### æ§‹é€ åŒ–ãƒ­ã‚°ã®ä½¿ç”¨
```typescript
// âœ… æ­£ã—ã„ä¾‹: æ§‹é€ åŒ–ãƒ­ã‚°
import { getLogger } from "../shared/logging/logger";

const logger = getLogger(c);
logger.apiRequest("POST /cattle", { userId, cattleId });
logger.unexpectedError("Failed to create cattle", error, { input });
```

### ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰å®Ÿè£…ãƒ«ãƒ¼ãƒ«

#### Container/Presentationalãƒ‘ã‚¿ãƒ¼ãƒ³
```typescript
// âœ… æ­£ã—ã„ä¾‹: Container Component
export default async function CattleDetailContainer({ id }: { id: string }) {
  try {
    const cattle = await GetCattleDetail(id);
    return <CattleDetailPresentation cattle={cattle} />;
  } catch (error) {
    console.error("Failed to fetch cattle:", error);
    return <CattleDetailPresentation cattle={undefined} error="ç‰›ã®æƒ…å ±ã®å–å¾—ã«å¤±æ•—ã—ã¾ã—ãŸ" />;
  }
}

// âœ… æ­£ã—ã„ä¾‹: Presentational Component
"use client";
export default function CattleDetailPresentation({ cattle, error }: Props) {
  if (error) return <ErrorDisplay message={error} />;
  if (!cattle) return <LoadingSpinner />;
  
  return (
    <div className="space-y-6">
      <CattleBasicInfo cattle={cattle} />
      <CattleBreedingInfo cattle={cattle} />
    </div>
  );
}
```

#### Server Actionså®Ÿè£…
```typescript
// âœ… æ­£ã—ã„ä¾‹: Server Actions
"use server";
export async function createCattleAction(prevState: unknown, formData: FormData) {
  const submission = parseWithZod(formData, { schema: createCattleSchema });
  
  if (submission.status !== "success") {
    return submission.reply();
  }

  try {
    const userId = await verifyAndGetUserId();
    if (isDemo(userId)) {
      return createDemoResponse("success");
    }

    await CreateCattle(submission.value);
    return submission.reply();
  } catch (error) {
    return submission.reply({
      formErrors: ["ä½œæˆã«å¤±æ•—ã—ã¾ã—ãŸ"]
    });
  }
}
```

## ç¦æ­¢äº‹é …

### ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰
- âŒ `console.log`ã®ä½¿ç”¨ï¼ˆæ§‹é€ åŒ–ãƒ­ã‚°ã‚’ä½¿ç”¨ï¼‰
- âŒ ç›´æ¥DBæ“ä½œï¼ˆRepositoryçµŒç”±ã§å®Ÿè¡Œï¼‰
- âŒ å±é™ºãªå‹ã‚­ãƒ£ã‚¹ãƒˆï¼ˆ`as any`ç­‰ï¼‰
- âŒ ä¾‹å¤–ã‚¹ãƒ­ãƒ¼ï¼ˆResultå‹ã‚’ä½¿ç”¨ï¼‰
- âŒ åˆ†æ•£ã—ãŸãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³ï¼ˆ`domain/codecs/input.ts`ã«çµ±åˆï¼‰

### ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰
- âŒ Containerå†…ã§ã®Client Componentå®Ÿè£…
- âŒ è¤‡é›‘ãªçŠ¶æ…‹ç®¡ç†ãƒ©ã‚¤ãƒ–ãƒ©ãƒªã®å°å…¥
- âŒ ç›´æ¥APIå‘¼ã³å‡ºã—ï¼ˆServiceå±¤çµŒç”±ï¼‰
- âŒ ãƒãƒ¼ãƒ‰ã‚³ãƒ¼ãƒ‰ã•ã‚ŒãŸè¨­å®šå€¤

## ãƒ†ã‚¹ãƒˆè¦ç´„

### ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰ãƒ†ã‚¹ãƒˆ
```typescript
// âœ… æ­£ã—ã„ä¾‹: ãƒ‰ãƒ¡ã‚¤ãƒ³ã‚µãƒ¼ãƒ“ã‚¹ãƒ†ã‚¹ãƒˆ
describe("createCattle", () => {
  it("should create cattle successfully", async () => {
    const mockRepo = { create: vi.fn().mockResolvedValue(1) };
    const mockClock = { now: () => new Date() };
    
    const result = await createCattle({ repo: mockRepo, clock: mockClock })(input);
    
    expect(result.ok).toBe(true);
    expect(mockRepo.create).toHaveBeenCalledWith(input);
  });
});
```

### ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰ãƒ†ã‚¹ãƒˆ
```typescript
// âœ… æ­£ã—ã„ä¾‹: Presentational Componentãƒ†ã‚¹ãƒˆ
describe("CattleDetailPresentation", () => {
  it("should render cattle data correctly", () => {
    render(<CattleDetailPresentation cattle={mockCattle} />);
    expect(screen.getByText(mockCattle.name)).toBeInTheDocument();
  });

  it("should render error state", () => {
    render(<CattleDetailPresentation cattle={undefined} error="Error" />);
    expect(screen.getByText("Error")).toBeInTheDocument();
  });
});
```

## é–‹ç™ºãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼

### æ–°æ©Ÿèƒ½è¿½åŠ æ‰‹é †
1. **ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰**: FDMãƒ‘ã‚¿ãƒ¼ãƒ³ã§ãƒ‰ãƒ¡ã‚¤ãƒ³â†’ã‚¤ãƒ³ãƒ•ãƒ©â†’HTTPå±¤ã®é †ã§å®Ÿè£…
2. **ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰**: Serviceâ†’Containerâ†’Presentationalã®é †ã§å®Ÿè£…
3. **ãƒ†ã‚¹ãƒˆ**: å„å±¤ã§ç‹¬ç«‹ã—ãŸãƒ†ã‚¹ãƒˆã‚’å®Ÿè£…
4. **ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆ**: å¿…è¦ã«å¿œã˜ã¦APIä»•æ§˜æ›¸ã‚’æ›´æ–°

### å“è³ªãƒã‚§ãƒƒã‚¯
- Biomeã«ã‚ˆã‚‹ãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆãƒ»ãƒªãƒ³ãƒˆãƒã‚§ãƒƒã‚¯
- TypeScriptå‹ãƒã‚§ãƒƒã‚¯
- ãƒ†ã‚¹ãƒˆã‚«ãƒãƒ¬ãƒƒã‚¸ç¢ºèª
- ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹ç¢ºèª

## æŠ€è¡“ã‚¹ã‚¿ãƒƒã‚¯

### ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰
- **ãƒ•ãƒ¬ãƒ¼ãƒ ãƒ¯ãƒ¼ã‚¯**: Hono + Cloudflare Workers
- **ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹**: Cloudflare D1 + Drizzle ORM
- **èªè¨¼**: JWT + Arctic
- **ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³**: Zod
- **ãƒ†ã‚¹ãƒˆ**: Vitest

### ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰
- **ãƒ•ãƒ¬ãƒ¼ãƒ ãƒ¯ãƒ¼ã‚¯**: Next.js 15 + React 19
- **UI**: shadcn/ui + Tailwind CSS
- **ãƒ•ã‚©ãƒ¼ãƒ **: React Hook Form + Conform
- **ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³**: Zod
- **ãƒ†ã‚¹ãƒˆ**: Vitest + Testing Library + Playwright

## é‡è¦ãªãƒ•ã‚¡ã‚¤ãƒ«

### è¨­å®šãƒ•ã‚¡ã‚¤ãƒ«
- `biome.json`: ã‚³ãƒ¼ãƒ‰ãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆãƒ»ãƒªãƒ³ãƒˆè¨­å®š
- `apps/api/wrangler.jsonc`: Cloudflare Workersè¨­å®š
- `apps/web/next.config.ts`: Next.jsè¨­å®š
- `apps/api/drizzle.config.ts`: Drizzle ORMè¨­å®š

### å…±é€šãƒ•ã‚¡ã‚¤ãƒ«
- `apps/api/src/shared/result.ts`: Resultå‹å®šç¾©
- `apps/api/src/shared/logging/logger.ts`: æ§‹é€ åŒ–ãƒ­ã‚°
- `apps/api/src/shared/types/safe-cast.ts`: å‹å®‰å…¨ã‚­ãƒ£ã‚¹ãƒˆ
- `apps/web/src/lib/api-client.ts`: APIã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆè¨­å®š

## ãƒ‡ãƒ—ãƒ­ã‚¤ãƒ»é‹ç”¨

### ç’°å¢ƒ
- **é–‹ç™º**: `pnpm dev`ï¼ˆAPI + Webä¸¦è¡Œèµ·å‹•ï¼‰
- **ãƒ†ã‚¹ãƒˆ**: `pnpm test:run`
- **ãƒ‡ãƒ—ãƒ­ã‚¤**: Cloudflare Pages + Workers

### ç›£è¦–
- æ§‹é€ åŒ–ãƒ­ã‚°ã«ã‚ˆã‚‹éšœå®³è¿½è·¡
- å‹å®‰å…¨æ€§ã«ã‚ˆã‚‹ãƒ©ãƒ³ã‚¿ã‚¤ãƒ ã‚¨ãƒ©ãƒ¼å‰Šæ¸›
- çµ±ä¸€ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°ã«ã‚ˆã‚‹ä¸€è²«ã—ãŸå“è³ª

ã“ã®ãƒ«ãƒ¼ãƒ«ã«å¾“ã†ã“ã¨ã§ã€Gyulistãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã®ä¸€è²«æ€§ã¨å“è³ªã‚’ç¶­æŒã—ãªãŒã‚‰é–‹ç™ºã‚’é€²ã‚ã‚‹ã“ã¨ãŒã§ãã¾ã™ã€‚

## è¿½åŠ è¨­è¨ˆãƒ»å®Ÿè£…ãƒ«ãƒ¼ãƒ«

### ğŸ”§ ä¾å­˜æ³¨å…¥ï¼ˆDIï¼‰ãƒ‘ã‚¿ãƒ¼ãƒ³

#### çµ±ä¸€DIè¨­å®šã®ä½¿ç”¨
```typescript
// âœ… æ­£ã—ã„ä¾‹: çµ±ä¸€DIè¨­å®šã‚’ä½¿ç”¨
import { makeDeps } from "../shared/config/di";

const deps = makeDeps(c.env.DB, { now: () => new Date() });
const result = await createCattle(deps)(input);

// âŒ é–“é•ã„: å€‹åˆ¥ã«DIè¨­å®š
const cattleRepo = makeCattleRepo(c.env.DB);
const clock = { now: () => new Date() };
const deps = { repo: cattleRepo, clock };
```

#### é…å»¶è©•ä¾¡ã®æ´»ç”¨
```typescript
// âœ… æ­£ã—ã„ä¾‹: é…å»¶è©•ä¾¡ã«ã‚ˆã‚‹ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹æœ€é©åŒ–
export function makeDeps(db: AnyD1Database, clock: ClockPort): CoreDeps {
  return {
    get cattleRepo() { return makeCattleRepo(db); }, // é…å»¶è©•ä¾¡
    get eventsRepo() { return makeEventsRepo(db); }, // é…å»¶è©•ä¾¡
    clock
  };
}
```

### ğŸ›¡ï¸ å‹å®‰å…¨ã‚­ãƒ£ã‚¹ãƒˆã‚·ã‚¹ãƒ†ãƒ 

#### Brandå‹ã®ä¸€è²«ã—ãŸä½¿ç”¨
```typescript
// âœ… æ­£ã—ã„ä¾‹: å‹å®‰å…¨ã‚­ãƒ£ã‚¹ãƒˆé–¢æ•°ä½¿ç”¨
import { toUserId, toCattleId } from "../shared/types/safe-cast";

const userId = toUserId(jwtPayload.userId);
const cattleId = toCattleId(params.id);

// âŒ é–“é•ã„: ç›´æ¥ã‚­ãƒ£ã‚¹ãƒˆ
const userId = jwtPayload.userId as UserId;
const cattleId = Number(params.id) as CattleId;
```

#### Resultå‹ãƒ‘ã‚¿ãƒ¼ãƒ³ã§ã®ã‚­ãƒ£ã‚¹ãƒˆ
```typescript
// âœ… æ­£ã—ã„ä¾‹: å¤±æ•—ã—ã†ã‚‹ã‚­ãƒ£ã‚¹ãƒˆ
import { tryCastUserId } from "../shared/types/safe-cast";

const userIdResult = tryCastUserId(input);
if (!userIdResult.success) {
  return err({ type: "ValidationError", message: userIdResult.error });
}
const userId = userIdResult.value;
```

### ğŸ“Š çµ±ä¸€ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°

#### executeUseCaseãƒ˜ãƒ«ãƒ‘ãƒ¼ã®ä½¿ç”¨
```typescript
// âœ… æ­£ã—ã„ä¾‹: çµ±ä¸€ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°
import { executeUseCase } from "../shared/http/route-helpers";

app.post("/", async (c) => {
  return executeUseCase(c, async () => {
    const result = await createCattle(deps)(input);
    if (!result.ok) return result;
    return { ok: true, value: { cattleId: result.value } };
  });
});

// âŒ é–“é•ã„: å€‹åˆ¥ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°
app.post("/", async (c) => {
  try {
    const result = await createCattle(deps)(input);
    if (!result.ok) {
      c.status(400);
      return c.json({ error: result.error });
    }
    return c.json({ cattleId: result.value }, 201);
  } catch (error) {
    console.error(error);
    return c.json({ message: "Internal Server Error" }, 500);
  }
});
```

### ğŸ” æ§‹é€ åŒ–ãƒ­ã‚°ã®çµ±ä¸€ä½¿ç”¨

#### å°‚ç”¨ãƒ­ã‚°ãƒ¡ã‚½ãƒƒãƒ‰ã®æ´»ç”¨
```typescript
// âœ… æ­£ã—ã„ä¾‹: å°‚ç”¨ãƒ­ã‚°ãƒ¡ã‚½ãƒƒãƒ‰
const logger = getLogger(c);
logger.apiRequest("POST", "/cattle", userId, requestId);
logger.businessError("Duplicate cattle ID", "ValidationError", { cattleId });
logger.unexpectedError("Database connection failed", error, { endpoint });

// âŒ é–“é•ã„: æ±ç”¨ãƒ­ã‚°
console.log("API request", { method: "POST", endpoint: "/cattle" });
console.error("Error occurred", error);
```

### ğŸ¯ Mapperså±¤ã®å¿…é ˆå®Ÿè£…

#### ãƒ‡ãƒ¼ã‚¿å¤‰æ›ã®ä¸€å…ƒåŒ–
```typescript
// âœ… æ­£ã—ã„ä¾‹: Mappersä½¿ç”¨
import { toDomain, toDomainList } from "../mappers/dbToDomain";
import { toDbInsert } from "../mappers/domainToDb";

// Repositoryå®Ÿè£…
async findById(id: CattleId): Promise<Cattle | null> {
  const [row] = await dbInstance.select().from(cattleTable).where(eq(cattleTable.id, id as number));
  return row ? toDomain(row) : null; // Mappersä½¿ç”¨
}

async create(entity: Cattle): Promise<Cattle> {
  const dbData = toDbInsert(entity);
  const [created] = await dbInstance.insert(cattleTable).values(dbData).returning();
  return toDomain(created);
}

// âŒ é–“é•ã„: ç›´æ¥å¤‰æ›
async findById(id: CattleId): Promise<Cattle | null> {
  const [row] = await dbInstance.select().from(cattleTable).where(eq(cattleTable.id, id as number));
  return row ? { id: row.id as CattleId, name: row.name } : null; // ç›´æ¥å¤‰æ›ç¦æ­¢
}
```

### ğŸ”„ ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰èªè¨¼ãƒ‘ã‚¿ãƒ¼ãƒ³

#### fetchWithAuthã®çµ±ä¸€ä½¿ç”¨
```typescript
// âœ… æ­£ã—ã„ä¾‹: çµ±ä¸€èªè¨¼ãƒ˜ãƒ«ãƒ‘ãƒ¼
import { fetchWithAuth } from "@/lib/api-client";

export async function GetCattleDetail(id: string): Promise<CattleDetail> {
  return fetchWithAuth<CattleDetail>((token) =>
    client.api.v1.cattle[id].$get(
      {},
      { headers: { Authorization: `Bearer ${token}` } }
    )
  );
}

// âŒ é–“é•ã„: å€‹åˆ¥èªè¨¼å‡¦ç†
export async function GetCattleDetail(id: string): Promise<CattleDetail> {
  const cookieStore = await cookies();
  const token = cookieStore.get("token")?.value;
  if (!token) redirect("/login");
  
  const res = await client.api.v1.cattle[id].$get(
    {},
    { headers: { Authorization: `Bearer ${token}` } }
  );
  if (!res.ok) throw new Error("API request failed");
  return res.json();
}
```

### ğŸ§ª ãƒ†ã‚¹ãƒˆãƒ‡ãƒ¼ã‚¿ãƒ•ã‚¡ã‚¯ãƒˆãƒª

#### ä¸€è²«ã—ãŸãƒ¢ãƒƒã‚¯ãƒ‡ãƒ¼ã‚¿ç”Ÿæˆ
```typescript
// âœ… æ­£ã—ã„ä¾‹: ãƒ†ã‚¹ãƒˆãƒ‡ãƒ¼ã‚¿ãƒ•ã‚¡ã‚¯ãƒˆãƒª
export function createMockCattle(overrides: Partial<Cattle> = {}): Cattle {
  return {
    id: 1 as CattleId,
    name: "Test Cattle",
    identificationNumber: 12345,
    gender: "FEMALE",
    status: "HEALTHY",
    createdAt: "2025-01-01T00:00:00Z",
    updatedAt: "2025-01-01T00:00:00Z",
    ...overrides
  };
}

export function createMockCattleRepo(): CattleRepoPort {
  return {
    findById: vi.fn(),
    create: vi.fn(),
    update: vi.fn(),
    delete: vi.fn(),
    search: vi.fn(),
  };
}

// ãƒ†ã‚¹ãƒˆã§ã®ä½¿ç”¨
describe("createCattle", () => {
  it("should create cattle successfully", async () => {
    const mockRepo = createMockCattleRepo();
    const mockCattle = createMockCattle({ name: "New Cattle" });
    vi.mocked(mockRepo.create).mockResolvedValue(mockCattle);
    
    const result = await createCattle({ repo: mockRepo, clock: mockClock })(input);
    expect(result.ok).toBe(true);
  });
});
```

### ğŸ“ ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³çµ±åˆ

#### ã‚¹ã‚­ãƒ¼ãƒã®ä¸€å…ƒç®¡ç†
```typescript
// âœ… æ­£ã—ã„ä¾‹: çµ±åˆãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³
// contexts/cattle/domain/codecs/input.ts
export const createCattleSchema = z.object({
  name: z.string().min(1).max(100),
  identificationNumber: z.number().positive(),
  gender: z.enum(["MALE", "FEMALE"]),
  birthDate: z.string().datetime().optional(),
});

export const updateCattleSchema = z.object({
  name: z.string().min(1).max(100).optional(),
  status: z.enum(["HEALTHY", "SICK", "PREGNANT"]).optional(),
});

// Routeã§ã®ä½¿ç”¨
app.post("/", zValidator("json", createCattleSchema), async (c) => {
  const data = c.req.valid("json"); // æ—¢ã«ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³æ¸ˆã¿
  // ãƒ¦ãƒ¼ã‚¹ã‚±ãƒ¼ã‚¹ã¯ãƒ“ã‚¸ãƒã‚¹ãƒ­ã‚¸ãƒƒã‚¯ã«é›†ä¸­
});

// âŒ é–“é•ã„: åˆ†æ•£ã—ãŸãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³
// validators/cattleValidator.ts (ä½¿ç”¨ç¦æ­¢)
// å„ãƒ•ã‚¡ã‚¤ãƒ«ã§å€‹åˆ¥ã«ã‚¹ã‚­ãƒ¼ãƒå®šç¾©
```

### ğŸ”’ ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£å®Ÿè£…

#### èªå¯ãƒã‚§ãƒƒã‚¯ã®æ˜ç¤ºåŒ–
```typescript
// âœ… æ­£ã—ã„ä¾‹: æ˜ç¤ºçš„èªå¯ãƒã‚§ãƒƒã‚¯
export const updateCattle = (deps: Deps) => async (cmd: UpdateCattleCmd) => {
  // å­˜åœ¨ç¢ºèª
  const existing = await deps.repo.findById(cmd.cattleId);
  if (!existing) {
    return err({ type: "NotFound", message: "Cattle not found" });
  }

  // èªå¯ãƒã‚§ãƒƒã‚¯
  if (existing.ownerUserId !== cmd.requesterUserId) {
    return err({ type: "Forbidden", message: "Not authorized" });
  }

  // æ›´æ–°å‡¦ç†
  return await deps.repo.update(cmd.cattleId, cmd.updates);
};
```

### ğŸš€ ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹æœ€é©åŒ–

#### ä¸¦åˆ—ãƒ‡ãƒ¼ã‚¿å–å¾—
```typescript
// âœ… æ­£ã—ã„ä¾‹: ä¸¦åˆ—å®Ÿè¡Œ
export default async function CattleDetailContainer({ id }: { id: string }) {
  try {
    const [cattle, events, breedingInfo] = await Promise.all([
      GetCattleDetail(id),
      GetCattleEvents(id),
      GetBreedingInfo(id)
    ]);
    
    return <CattleDetailPresentation 
      cattle={cattle} 
      events={events} 
      breedingInfo={breedingInfo} 
    />;
  } catch (error) {
    // ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°
  }
}

// âŒ é–“é•ã„: ç›´åˆ—å®Ÿè¡Œ
export default async function SlowContainer({ id }: { id: string }) {
  const cattle = await GetCattleDetail(id);
  const events = await GetCattleEvents(id);
  const breedingInfo = await GetBreedingInfo(id);
  // é…ã„
}
```

### ğŸ“Š ç›£è¦–ãƒ»é‹ç”¨

#### ãƒ¡ãƒˆãƒªã‚¯ã‚¹åé›†
```typescript
// âœ… æ­£ã—ã„ä¾‹: ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹ç›£è¦–
const startTime = Date.now();
const result = await useCase(deps)(input);
const duration = Date.now() - startTime;

logger.apiResponse("POST", "/cattle", 201, duration, userId, requestId);

// ãƒ¬ã‚¹ãƒãƒ³ã‚¹ãƒ˜ãƒƒãƒ€ãƒ¼ã§ã®ãƒ¡ãƒˆãƒªã‚¯ã‚¹æä¾›
c.header("X-Response-Time", `${duration}ms`);
c.header("X-Request-ID", requestId);
```

### ğŸ”„ ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹è¨­è¨ˆ

#### ãƒã‚¤ã‚°ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ç®¡ç†
```typescript
// âœ… æ­£ã—ã„ä¾‹: æ®µéšçš„ãƒã‚¤ã‚°ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³
export async function up(db: AnyD1Database) {
  await db.exec(`
    CREATE TABLE IF NOT EXISTS cattle_status_history (
      id INTEGER PRIMARY KEY AUTOINCREMENT,
      cattle_id INTEGER NOT NULL,
      old_status TEXT,
      new_status TEXT NOT NULL,
      changed_by INTEGER NOT NULL,
      reason TEXT,
      created_at TEXT NOT NULL,
      FOREIGN KEY (cattle_id) REFERENCES cattle(cattle_id),
      FOREIGN KEY (changed_by) REFERENCES users(user_id)
    );
    
    CREATE INDEX IF NOT EXISTS idx_cattle_status_history_cattle_id 
    ON cattle_status_history(cattle_id);
  `);
}
```

### ğŸ¨ UI/UXè¨­è¨ˆ

#### ã‚¢ã‚¯ã‚»ã‚·ãƒ“ãƒªãƒ†ã‚£å¯¾å¿œ
```typescript
// âœ… æ­£ã—ã„ä¾‹: ã‚¢ã‚¯ã‚»ã‚·ãƒ“ãƒªãƒ†ã‚£é…æ…®
export function CattleForm({ onSubmit }: Props) {
  return (
    <form onSubmit={onSubmit}>
      <label htmlFor="cattle-name">ç‰›ã®åå‰</label>
      <input 
        id="cattle-name"
        name="name"
        aria-describedby="name-help"
        aria-required="true"
      />
      <div id="name-help">ç‰›ã®åå‰ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„ï¼ˆ1-100æ–‡å­—ï¼‰</div>
      
      <button type="submit" aria-label="ç‰›ã‚’ç™»éŒ²">
        ç™»éŒ²
      </button>
    </form>
  );
}
```

### ğŸ”§ é–‹ç™ºãƒ„ãƒ¼ãƒ«

#### ãƒ‡ãƒãƒƒã‚°æ”¯æ´
```typescript
// âœ… æ­£ã—ã„ä¾‹: é–‹ç™ºç’°å¢ƒã§ã®ãƒ‡ãƒãƒƒã‚°æ”¯æ´
if (process.env.NODE_ENV === "development") {
  logger.debug("Request details", {
    method: c.req.method,
    url: c.req.url,
    headers: Object.fromEntries(c.req.header()),
    body: await c.req.json().catch(() => "Unable to parse body")
  });
}
```

ã“ã‚Œã‚‰ã®è¿½åŠ ãƒ«ãƒ¼ãƒ«ã«ã‚ˆã‚Šã€ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã®å“è³ªã€ä¿å®ˆæ€§ã€ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ã€ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹ãŒã•ã‚‰ã«å‘ä¸Šã—ã¾ã™ã€‚